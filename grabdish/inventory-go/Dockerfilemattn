FROM golang:1.11.3

RUN apt-get update
RUN apt-get install -y pkg-config && \
    apt-get install -y libaio1 && \
    apt-get install unzip

ENV CLIENT_FILENAME instantclient_12_1.zip
COPY /oracle/${CLIENT_FILENAME} .
COPY /oracle/oci8.pc /usr/lib/pkgconfig/oci8.pc

ENV LD_LIBRARY_PATH /usr/lib:/usr/local/lib:/usr/instantclient_12_1

RUN unzip ${CLIENT_FILENAME} -d /usr &&  \
    ln -s /usr/instantclient_12_1/libclntsh.so.12.1 /usr/instantclient_12_1/libclntsh.so && \
    ln -s /usr/instantclient_12_1/libclntshcore.so.12.1 /usr/instantclient_12_1/libclntshcore.so && \
    ln -s /usr/instantclient_12_1/libocci.so.12.1 /usr/instantclient_12_1/libocci.so
    
RUN go get -u github.com/mattn/go-oci8

WORKDIR /src
COPY inventory.go inventory.go

# RUN export TNS_ADMIN=/Users/pparkins/Downloads/Wallet_grabdish4X2
ENV TNS_ADMIN /Users/pparkins/Downloads/Wallet_grabdish4X2
RUN echo TNS_ADMIN: $TNS_ADMIN
# go build -o bin/example .
# RUN go build -o /out/example .
RUN go build -o /out/dbaccess .
# RUN go build -x inventory.go
# RUN go build -x inventory.go dbaccess
RUN echo go version

# RUN go build -o main .
# EXPOSE 8080

CMD ["/out/dbaccess"]