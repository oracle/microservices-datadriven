<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.140.1">
    <meta name="generator" content="Relearn 7.1.1+ab4197f3113afa9a7d17bed69dbef6c0e75a4921">
    <meta name="description" content="Next, you will create the â€œCheck Processingâ€ microservice which you will receive messages from the ATM and Back Office and process them by calling the appropriate endpoints on the Account service. This service will also introduce the use of service discovery using OpenFeign clients.
Create a new Java Project for the checks service.
In the Explorer of VS Code open Java Project and click the plus sign to add a Java Project to your workspace.">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Create the Check Processing Microservice :: CloudBank AI">
    <meta name="twitter:description" content="Next, you will create the â€œCheck Processingâ€ microservice which you will receive messages from the ATM and Back Office and process them by calling the appropriate endpoints on the Account service. This service will also introduce the use of service discovery using OpenFeign clients.
Create a new Java Project for the checks service.
In the Explorer of VS Code open Java Project and click the plus sign to add a Java Project to your workspace.">
    <meta property="og:url" content="https://oracle.github.io/microservices-datadriven/cloudbank/check/check-processing/index.html">
    <meta property="og:site_name" content="CloudBank AI">
    <meta property="og:title" content="Create the Check Processing Microservice :: CloudBank AI">
    <meta property="og:description" content="Next, you will create the â€œCheck Processingâ€ microservice which you will receive messages from the ATM and Back Office and process them by calling the appropriate endpoints on the Account service. This service will also introduce the use of service discovery using OpenFeign clients.
Create a new Java Project for the checks service.
In the Explorer of VS Code open Java Project and click the plus sign to add a Java Project to your workspace.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Check Processing">
    <meta itemprop="name" content="Create the Check Processing Microservice :: CloudBank AI">
    <meta itemprop="description" content="Next, you will create the â€œCheck Processingâ€ microservice which you will receive messages from the ATM and Back Office and process them by calling the appropriate endpoints on the Account service. This service will also introduce the use of service discovery using OpenFeign clients.
Create a new Java Project for the checks service.
In the Explorer of VS Code open Java Project and click the plus sign to add a Java Project to your workspace.">
    <meta itemprop="wordCount" content="1950">
    <title>Create the Check Processing Microservice :: CloudBank AI</title>
    <link href="/microservices-datadriven/cloudbank/images/favicon.png?1741199486" rel="icon" type="image/png">
    <link href="/microservices-datadriven/cloudbank/css/fontawesome-all.min.css?1741199486" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/microservices-datadriven/cloudbank/css/fontawesome-all.min.css?1741199486" rel="stylesheet"></noscript>
    <link href="/microservices-datadriven/cloudbank/css/nucleus.css?1741199486" rel="stylesheet">
    <link href="/microservices-datadriven/cloudbank/css/auto-complete.css?1741199486" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/microservices-datadriven/cloudbank/css/auto-complete.css?1741199486" rel="stylesheet"></noscript>
    <link href="/microservices-datadriven/cloudbank/css/perfect-scrollbar.min.css?1741199486" rel="stylesheet">
    <link href="/microservices-datadriven/cloudbank/css/fonts.css?1741199486" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/microservices-datadriven/cloudbank/css/fonts.css?1741199486" rel="stylesheet"></noscript>
    <link href="/microservices-datadriven/cloudbank/css/theme.css?1741199486" rel="stylesheet">
    <link href="/microservices-datadriven/cloudbank/css/theme-zen-light.css?1741199486" rel="stylesheet" id="R-variant-style">
    <link href="/microservices-datadriven/cloudbank/css/chroma-relearn-light.css?1741199486" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/microservices-datadriven/cloudbank/css/print.css?1741199486" rel="stylesheet" media="print">
    <script src="/microservices-datadriven/cloudbank/js/variant.js?1741199486"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='https:\/\/oracle.github.io\/microservices-datadriven\/cloudbank';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      // variant stuff
      window.variants && variants.init( [ 'zen-light' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-7HWQVTJ803"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-7HWQVTJ803');
        }
      </script>
  </head>
  <body class="mobile-support html" data-url="/microservices-datadriven/cloudbank/check/check-processing/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"> 
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/microservices-datadriven/cloudbank/index.html"><span itemprop="name">CloudBank AI</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/microservices-datadriven/cloudbank/check/index.html"><span itemprop="name">Check Processing</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Create the Check Processing Microservice</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/microservices-datadriven/cloudbank/check/create-testrunner/index.html" title="Create the Test Runner Microservice (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/microservices-datadriven/cloudbank/check/test/index.html" title="Test the end-to-end flow (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable check" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="create-the-check-processing-microservice">Create the Check Processing Microservice</h1>

<p>Next, you will create the &ldquo;Check Processing&rdquo; microservice which you will receive messages from the ATM and Back Office and process them by calling the appropriate endpoints on the Account service. This service will also introduce the use of service discovery using <a href="https://spring.io/projects/spring-cloud-openfeign" rel="external" target="_blank">OpenFeign</a> clients.</p>
<ol>
<li>
<p>Create a new Java Project for the <code>checks</code> service.</p>
<p>In the Explorer of VS Code open <code>Java Project</code> and click the <strong>plus</strong> sign to add a Java Project to your workspace.</p>
<p><a href="#R-image-dc6a728533dddcd49ffb6e2e54ae4109" class="lightbox-link"><img alt="Add Java Project" class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="../images/add_java_project.png" style=" height: auto; width: auto;" title=" "></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-dc6a728533dddcd49ffb6e2e54ae4109"><img alt="Add Java Project" class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="../images/add_java_project.png" title=" "></a></p>
<p>Select Spring Boot Project.</p>
<p><a href="#R-image-af280718f83ddd39bd85b0c237cfb52c" class="lightbox-link"><img alt="Spring Boot Project" class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="../images/spring-boot-prj.png" style=" height: auto; width: auto;" title=" "></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-af280718f83ddd39bd85b0c237cfb52c"><img alt="Spring Boot Project" class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="../images/spring-boot-prj.png" title=" "></a></p>
<p>Select Maven Project.</p>
<p><a href="#R-image-7b344eed4a3e6157166701b6ec22787f" class="lightbox-link"><img alt="Maven Project" class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="../images/maven-project.png" style=" height: auto; width: auto;" title=" "></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7b344eed4a3e6157166701b6ec22787f"><img alt="Maven Project" class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="../images/maven-project.png" title=" "></a></p>
<p>Specify <code>3.3.4</code> as the Spring Boot version.</p>
<p><a href="#R-image-bae48c7390cd5a54a69459efc7f45525" class="lightbox-link"><img alt="Spring Boot Version" class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="../images/spring-boot-version.png" style=" height: auto; width: auto;" title=" "></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-bae48c7390cd5a54a69459efc7f45525"><img alt="Spring Boot Version" class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="../images/spring-boot-version.png" title=" "></a></p>
<p>Use <code>com.example</code> as the Group Id.</p>
<p><a href="#R-image-c69fb511d6e083fc4a6f3dba4de0ca25" class="lightbox-link"><img alt="Group Id" class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="../images/group-id.png" style=" height: auto; width: auto;" title=" "></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-c69fb511d6e083fc4a6f3dba4de0ca25"><img alt="Group Id" class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="../images/group-id.png" title=" "></a></p>
<p>Enter <code>checks</code> as the Artifact Id.</p>
<p><a href="#R-image-f3c9569a22fc6f6cb9fd6389d9ca43f8" class="lightbox-link"><img alt="Artifact Id" class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="../images/artifact-id-checks.png" style=" height: auto; width: auto;" title=" "></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-f3c9569a22fc6f6cb9fd6389d9ca43f8"><img alt="Artifact Id" class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="../images/artifact-id-checks.png" title=" "></a></p>
<p>Use <code>JAR</code> as the Packaging Type.</p>
<p><a href="#R-image-32c42eda507a8d68606072a533031b62" class="lightbox-link"><img alt="Packaging Type" class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="../images/packaging-type.png" style=" height: auto; width: auto;" title=" "></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-32c42eda507a8d68606072a533031b62"><img alt="Packaging Type" class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="../images/packaging-type.png" title=" "></a></p>
<p>Select Java version <code>21</code>.</p>
<p><a href="#R-image-9e5f8ca3f4936e6a327f24d0f84870f3" class="lightbox-link"><img alt="Java Version" class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="../images/java-version.png" style=" height: auto; width: auto;" title=" "></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-9e5f8ca3f4936e6a327f24d0f84870f3"><img alt="Java Version" class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="../images/java-version.png" title=" "></a></p>
<p>Search for <code>Spring Web</code>, <code>Lombok</code>, <code>Feign</code> and <code>Eureka Client</code>. When all are selected press <strong>Enter</strong>.</p>
<p><a href="#R-image-705ab3c3435146c49f360a35e9dafd7f" class="lightbox-link"><img alt="Search for Spring Web" class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="../images/checks-dependencies.png" style=" height: auto; width: auto;" title=" "></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-705ab3c3435146c49f360a35e9dafd7f"><img alt="Search for Spring Web" class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="../images/checks-dependencies.png" title=" "></a></p>
<p>Press <strong>Enter</strong> to continue and create the Java Project</p>
<p><a href="#R-image-efe633ae0463ee056cc380c08e1ab3af" class="lightbox-link"><img alt="Create Project" class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="../images/create-project.png" style=" height: auto; width: auto;" title=" "></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-efe633ae0463ee056cc380c08e1ab3af"><img alt="Create Project" class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="../images/create-project.png" title=" "></a></p>
<p>Select the <code>root</code> location for your project e.g. side by side with the <code>checks</code>, <code>testrunner</code> and <code>account</code> projects.</p>
<p><a href="#R-image-71134782747a0a04f3a5576bc098496a" class="lightbox-link"><img alt="Project Location" class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="../images/project-location.png" style=" height: auto; width: auto;" title=" "></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-71134782747a0a04f3a5576bc098496a"><img alt="Project Location" class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="../images/project-location.png" title=" "></a></p>
<p>When the project opens click <strong>Add to Workspace</strong></p>
<p><a href="#R-image-7db19cd0f3bbd8af85b477cfee9f79a8" class="lightbox-link"><img alt="Add to Workspace" class="noborder lazy lightbox noshadow figure-image" loading="lazy" src="../images/add-to-workspace.png" style=" height: auto; width: auto;" title=" "></a>
<a href="javascript:history.back();" class="lightbox-back" id="R-image-7db19cd0f3bbd8af85b477cfee9f79a8"><img alt="Add to Workspace" class="noborder lazy lightbox noshadow lightbox-image" loading="lazy" src="../images/add-to-workspace.png" title=" "></a></p>
</li>
<li>
<p>Update the <code>pom.xml</code> file for Oracle Spring Boot Starters</p>
<p>It is very similar to the POM for the account and test runner services, however the dependencies are slightly different.  This service will use the &ldquo;Web&rdquo; Spring Boot Starter which will allow it to expose REST endpoints and make REST calls to other services. It also uses the two Oracle Spring Boot Starters for UCP and Wallet to access the database. You will also add the Eureka client and <a href="https://spring.io/projects/spring-cloud-openfeign" rel="external" target="_blank">OpenFeign</a> dependencies to allow service discovery and client side load balancing. Open the <code>pom.xml</code> and add the following to the <code>pom.xml</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;groupId&gt;</span>com.oracle.database.spring<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;artifactId&gt;</span>oracle-spring-boot-starter-aqjms<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;version&gt;</span>23.4.0<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;dependency&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;groupId&gt;</span>com.oracle.database.spring<span style="color:#f92672">&lt;/groupId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;artifactId&gt;</span>oracle-spring-boot-starter-wallet<span style="color:#f92672">&lt;/artifactId&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;type&gt;</span>pom<span style="color:#f92672">&lt;/type&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;version&gt;</span>23.4.0<span style="color:#f92672">&lt;/version&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/dependency&gt;</span></span></span></code></pre></div>
</li>
<li>
<p>Create the Spring Boot application YAML file</p>
<p>In the <code>checks</code> project, rename the file called <code>application.properties</code> to <code>application.yaml</code> located in the <code>src/main/resources</code>. This will be the Spring Boot application configuration file. Add the following content:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spring</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">application</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">checks</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">datasource</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">url</span>: <span style="color:#ae81ff">${spring.datasource.url}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">username</span>: <span style="color:#ae81ff">${spring.datasource.username}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">password</span>: <span style="color:#ae81ff">${spring.datasource.password}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">eureka</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">instance</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostname</span>: <span style="color:#ae81ff">${spring.application.name}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">preferIpAddress</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">client</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">service-url</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">defaultZone</span>: <span style="color:#ae81ff">${eureka.service-url}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">fetch-registry</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">register-with-eureka</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span></span></span></code></pre></div>
<p>This is the Spring Boot application YAML file, which contains the configuration information for this service.  In this case, you need to provide the application name and the connection details for the database hosting the queues and the information for the Eureka server as the checks application will use a Feign client.</p>
</li>
<li>
<p>Create the main Spring Application class</p>
<p>In the <code>checks</code> directory, create a new directory called <code>src/main/java/com/example/checks</code> and in that directory, create a new Java file called <code>ChecksApplication.java</code> with this content.  This is a standard Spring Boot main class, notice the <code>SpringBootApplication</code> annotation on the class.  It also has the <code>EnableJms</code> annotation which tells Spring Boot to enable JMS functionality in this application.  The <code>main</code> method is a normal Spring Boot main method:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.example.checks;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> jakarta.jms.ConnectionFactory;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.boot.SpringApplication;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.boot.autoconfigure.jms.DefaultJmsListenerContainerFactoryConfigurer;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.cloud.openfeign.EnableFeignClients;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.context.annotation.Bean;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.jms.annotation.EnableJms;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.jms.config.DefaultJmsListenerContainerFactory;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.jms.config.JmsListenerContainerFactory;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.jms.core.JmsTemplate;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.jms.support.converter.MappingJackson2MessageConverter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.jms.support.converter.MessageConverter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.jms.support.converter.MessageType;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@SpringBootApplication</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableFeignClients</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@EnableJms</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChecksApplication</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        SpringApplication.<span style="color:#a6e22e">run</span>(ChecksApplication.<span style="color:#a6e22e">class</span>, args);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span> <span style="color:#75715e">// Serialize message content to json using TextMessage</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> MessageConverter <span style="color:#a6e22e">jacksonJmsMessageConverter</span>() {
</span></span><span style="display:flex;"><span>        MappingJackson2MessageConverter converter <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MappingJackson2MessageConverter();
</span></span><span style="display:flex;"><span>        converter.<span style="color:#a6e22e">setTargetType</span>(MessageType.<span style="color:#a6e22e">TEXT</span>);
</span></span><span style="display:flex;"><span>        converter.<span style="color:#a6e22e">setTypeIdPropertyName</span>(<span style="color:#e6db74">&#34;_type&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> converter;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> JmsTemplate <span style="color:#a6e22e">jmsTemplate</span>(ConnectionFactory connectionFactory) {
</span></span><span style="display:flex;"><span>        JmsTemplate jmsTemplate <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JmsTemplate();
</span></span><span style="display:flex;"><span>        jmsTemplate.<span style="color:#a6e22e">setConnectionFactory</span>(connectionFactory);
</span></span><span style="display:flex;"><span>        jmsTemplate.<span style="color:#a6e22e">setMessageConverter</span>(jacksonJmsMessageConverter());
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> jmsTemplate;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Bean</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> JmsListenerContainerFactory<span style="color:#f92672">&lt;?&gt;</span> factory(ConnectionFactory connectionFactory,
</span></span><span style="display:flex;"><span>                            DefaultJmsListenerContainerFactoryConfigurer configurer) {
</span></span><span style="display:flex;"><span>        DefaultJmsListenerContainerFactory factory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DefaultJmsListenerContainerFactory();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// This provides all boot&#39;s default to this factory, including the message converter</span>
</span></span><span style="display:flex;"><span>        configurer.<span style="color:#a6e22e">configure</span>(factory, connectionFactory);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// You could still override some of Boot&#39;s default if necessary.</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> factory;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>As in the Test Runner service, you will also need the <code>MessageConverter</code> and <code>JmsTemplate</code> beans.  You will also need an additional bean in this service, the <code>JmsListenerConnectionFactory</code>.  This bean will be used to create listeners that receive messages from JMS queues.  Note that the JMS <code>ConnectionFactory</code> is injected as in the Test Runner service.</p>
</li>
<li>
<p>Create the model classes</p>
<p>Create a directory called <code>src/main/java/com/example/testrunner/model</code> and in that directory create the two model classes.</p>
<p><strong>Note</strong>: These are in the <code>testrunner</code> package, not the <code>checks</code> package!  The classes used for serialization and deserialization of the messages need to be the same so that the <code>MessageConverter</code> knows what to do.</p>
<p>First, <code>CheckDeposit.java</code> with this content:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.example.testrunner.model;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.AllArgsConstructor;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.Data;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.Getter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.NoArgsConstructor;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.Setter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.ToString;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@AllArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@NoArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Getter</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Setter</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@ToString</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CheckDeposit</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">long</span> accountId;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">long</span> amount;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>And then, <code>Clearance.java</code> with this content:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.example.testrunner.model;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.AllArgsConstructor;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.Data;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.Getter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.NoArgsConstructor;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.Setter;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.ToString;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@AllArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@NoArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Getter</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Setter</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@ToString</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Clearance</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">long</span> journalId;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</li>
<li>
<p>Create the OpenFeign clients</p>
<blockquote>
<p><strong>OpenFeign</strong>
In this step you will use OpenFeign to create a client.  OpenFeign allows you to look up an instance of a service from the Spring Eureka Service Registry using its key/identifier, and will create a client for you to call endpoints on that service.  It also provides client-side load balancing.  This allows you to easily create REST clients without needing to know the address of the service or how many instances are running.</p>
</blockquote>
<p>Create a directory called <code>src/main/java/com/example/checks/clients</code> and in this directory create a new Java interface called <code>AccountClient.java</code> to define the OpenFeign client for the account service. Here is the content:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.example.checks.clients;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.cloud.openfeign.FeignClient;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.PathVariable;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.PostMapping;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.web.bind.annotation.RequestBody;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@FeignClient</span>(<span style="color:#e6db74">&#34;account&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">AccountClient</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span>(<span style="color:#e6db74">&#34;/api/v1/account/journal&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">journal</span>(<span style="color:#a6e22e">@RequestBody</span> Journal journal);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@PostMapping</span>(<span style="color:#e6db74">&#34;/api/v1/account/journal/{journalId}/clear&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">clear</span>(<span style="color:#a6e22e">@PathVariable</span> <span style="color:#66d9ef">long</span> journalId);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>In the interface, you define methods for each of the endpoints you want to be able to call.  As you see, you specify the request type with an annotation, the endpoint path, and you can specify path variables and the body type.  You will need to define the <code>Journal</code> class.</p>
<p>In the same directory, create a Java class called <code>Journal.java</code> with the following content:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.example.checks.clients;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.AllArgsConstructor;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.Data;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.NoArgsConstructor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Data</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@AllArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@NoArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Journal</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">long</span> journalId;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String journalType;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">long</span> accountId;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String lraId;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String lraState;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">long</span> journalAmount;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Journal</span>(String journalType, <span style="color:#66d9ef">long</span> accountId, <span style="color:#66d9ef">long</span> journalAmount) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">journalType</span> <span style="color:#f92672">=</span> journalType;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">accountId</span> <span style="color:#f92672">=</span> accountId;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">journalAmount</span> <span style="color:#f92672">=</span> journalAmount;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">lraId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">lraState</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p><strong>Note</strong>:  The <code>lraId</code> and <code>lraState</code> field are set to reasonable default values, since we are not going to be using those fields in this lab.</p>
</li>
<li>
<p>Create the services</p>
<p>Next, you will create a service to implement the methods defined in the OpenFeign client interface.  Create a directory called <code>src/main/java/com/example/checks/service</code> and in that directory create a Java class called <code>AccountService.java</code> with this content.  The services are very simple, you just need to use the <code>accountClient</code> to call the appropriate endpoint on the Account service and pass through the data. <strong>Note</strong> the <code>AccountClient</code> will be injected by Spring Boot because of the <code>RequiredArgsConstructor</code> annotation, which saves some boilerplate constructor code:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.example.checks.service;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Service;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.checks.clients.AccountClient;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.checks.clients.Journal;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.testrunner.model.Clearance;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.RequiredArgsConstructor;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Service</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@RequiredArgsConstructor</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AccountService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> AccountClient accountClient;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">journal</span>(Journal journal) {
</span></span><span style="display:flex;"><span>        accountClient.<span style="color:#a6e22e">journal</span>(journal);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">clear</span>(Clearance clearance) {
</span></span><span style="display:flex;"><span>        accountClient.<span style="color:#a6e22e">clear</span>(clearance.<span style="color:#a6e22e">getJournalId</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</li>
<li>
<p>Create the Check Receiver controller</p>
<p>This controller will receive messages on the <code>deposits</code> JMS queue and process them by calling the <code>journal</code> method in the <code>AccountService</code> that you just created, which will make a REST POST to the Account service, which in turn will write the journal entry into the accounts&rsquo; database.</p>
<p>Create a directory called <code>src/main/java/com/example/checks/controller</code> and in that directory, create a new Java class called <code>CheckReceiver.java</code> with the following content.  You will need to inject an instance of the <code>AccountService</code> (in this example the constructor is provided, so you can compare to the annotation used previously). Implement a method to receive and process the messages. To receive messages from the queues, use the <code>JmsListener</code> annotation and provide the queue and factory names. This method should call the <code>journal</code> method on the <code>AccountService</code> and pass through the necessary data.  Also, notice that you need to add the <code>Component</code> annotation to the class so that Spring Boot will load an instance of it into the application:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.example.checks.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.jms.annotation.JmsListener;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Component;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.checks.clients.Journal;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.checks.service.AccountService;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.testrunner.model.CheckDeposit;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.extern.slf4j.Slf4j;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CheckReceiver</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> AccountService accountService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">CheckReceiver</span>(AccountService accountService) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">accountService</span> <span style="color:#f92672">=</span> accountService;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@JmsListener</span>(destination <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;deposits&#34;</span>, containerFactory <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;factory&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">receiveMessage</span>(CheckDeposit deposit) {
</span></span><span style="display:flex;"><span>        log.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Received deposit &lt;&#34;</span> <span style="color:#f92672">+</span> deposit <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        accountService.<span style="color:#a6e22e">journal</span>(<span style="color:#66d9ef">new</span> Journal(<span style="color:#e6db74">&#34;PENDING&#34;</span>, deposit.<span style="color:#a6e22e">getAccountId</span>(), deposit.<span style="color:#a6e22e">getAmount</span>()));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</li>
<li>
<p>Create the Clearance Receiver controller</p>
<p>In the same directory, create another Java class called <code>ClearanceReceiver.java</code> with the following content.  This is very similar to the previous controller, but listens to the <code>clearances</code> queue instead, and calls the <code>clear</code> method on the <code>AccountService</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.example.checks.controller;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.jms.annotation.JmsListener;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Component;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.checks.service.AccountService;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.testrunner.model.Clearance;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.extern.slf4j.Slf4j;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Slf4j</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClearanceReceiver</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> AccountService accountService;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClearanceReceiver</span>(AccountService accountService) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">accountService</span> <span style="color:#f92672">=</span> accountService;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@JmsListener</span>(destination <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;clearances&#34;</span>, containerFactory <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;factory&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">receiveMessage</span>(Clearance clearance) {
</span></span><span style="display:flex;"><span>        log.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Received clearance &lt;&#34;</span> <span style="color:#f92672">+</span> clearance <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&gt;&#34;</span>);
</span></span><span style="display:flex;"><span>        accountService.<span style="color:#a6e22e">clear</span>(clearance);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>That completes the Check Processing service.  Now you can deploy and test it.</p>
</li>
<li>
<p>Build a JAR file for deployment</p>
<p>Run the following command to build the JAR file.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ mvn clean package -DskipTests</span></span></code></pre></div>
<p>The service is now ready to deploy to the backend.</p>
</li>
<li>
<p>Prepare the backend for deployment</p>
<p>The Oracle Backend for Microservices and AI admin service is not exposed outside the Kubernetes cluster by default. Oracle recommends using a <strong>kubectl</strong> port forwarding tunnel to establish a secure connection to the admin service.</p>
<p>Start a tunnel using this command in a new terminal window:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl -n obaas-admin port-forward svc/obaas-admin <span style="color:#ae81ff">8080</span></span></span></code></pre></div>
<p>Get the password for the <code>obaas-admin</code> user. The <code>obaas-admin</code> user is the equivalent of the admin or root user in the Oracle Backend for Microservices and AI backend.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl get secret -n azn-server  oractl-passwords -o jsonpath<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;{.data.admin}&#39;</span> | base64 -d</span></span></code></pre></div>
<p>Start the Oracle Backend for Microservices and AI CLI (<em>oractl</em>) in a new terminal window using this command:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ oractl
</span></span><span style="display:flex;"><span> _   _           __    _    ___
</span></span><span style="display:flex;"><span>/ <span style="color:#ae81ff">\ </span>|_<span style="color:#f92672">)</span>  _.  _. <span style="color:#f92672">(</span>_    /  |   |
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">\_</span>/ |_<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>_| <span style="color:#f92672">(</span>_| __<span style="color:#f92672">)</span>   <span style="color:#ae81ff">\_</span> |_ _|_
</span></span><span style="display:flex;"><span><span style="color:#f92672">========================================================================================</span>
</span></span><span style="display:flex;"><span>  Application Name: Oracle Backend Platform :: Command Line Interface
</span></span><span style="display:flex;"><span>  Application Version: <span style="color:#f92672">(</span>1.3.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  :: Spring Boot <span style="color:#f92672">(</span>v3.3.3<span style="color:#f92672">)</span> ::
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Ask <span style="color:#66d9ef">for</span> help:
</span></span><span style="display:flex;"><span>  - Slack: https://oracledevs.slack.com/archives/C03ALDSV272
</span></span><span style="display:flex;"><span>  - email: obaas_ww@oracle.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>oractl:&gt;</span></span></code></pre></div>
<p>Connect to the Oracle Backend for Microservices and AI admin service using the <code>connect</code> command. Enter <code>obaas-admin</code> and the username and use the password you collected earlier.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>oractl&gt; connect
</span></span><span style="display:flex;"><span>username: obaas-admin
</span></span><span style="display:flex;"><span>password: **************
</span></span><span style="display:flex;"><span>Credentials successfully authenticated! obaas-admin -&gt; welcome to OBaaS CLI.
</span></span><span style="display:flex;"><span>oractl:&gt;</span></span></code></pre></div>
</li>
<li>
<p>Create a binding for the Check service</p>
<p>Create a binding so the Check service can access the Oracle Autonomous Database as the <code>account</code> user. Run this command to create the binding, and type in the password for the <code>account</code> user when prompted. The password is <code>Welcome1234##</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>oractl:&gt; bind --app-name application --service-name checks --username account</span></span></code></pre></div>
</li>
<li>
<p>Deploy the Check service</p>
<p>You will now deploy your Check service to the Oracle Backend for Microservices and AI using the CLI. Run this command to deploy your service, make sure you provide the correct path to your JAR file. <strong>Note</strong> that this command may take 1-3 minutes to complete:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>oractl:&gt; deploy --app-name application --service-name checks --artifact-path /path/to/checks-0.0.1-SNAPSHOT.jar --image-version 0.0.1 --java-version ghcr.io/oracle/graalvm-native-image-obaas:21
</span></span><span style="display:flex;"><span>uploading: testrunner/target/testrunner-0.0.1-SNAPSHOT.jarbuilding and pushing image...
</span></span><span style="display:flex;"><span>creating deployment and service... successfully deployed
</span></span><span style="display:flex;"><span>oractl:&gt;</span></span></code></pre></div>
<p>You can close the port forwarding session for the CLI now (just type a Ctrl+C in its console window).</p>
</li>
<li>
<p>Testing the service</p>
<p>Since you had messages already sitting on the queues, the service should process those as soon as it starts.  You can check the service logs to see the log messages indicating this happened using this command:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ kubectl -n application logs svc/checks
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span> ... lines omitted ...<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Received deposit &lt;CheckDeposit<span style="color:#f92672">(</span>accountId<span style="color:#f92672">=</span>2, amount<span style="color:#f92672">=</span>200<span style="color:#f92672">)</span>&gt;
</span></span><span style="display:flex;"><span>Received clearance &lt;Clearance<span style="color:#f92672">(</span>journalId<span style="color:#f92672">=</span>4<span style="color:#f92672">)</span>&gt;
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span> ... lines omitted ...<span style="color:#f92672">)</span></span></span></code></pre></div>
<p>You can also look at the journal table in the database to see the results.</p>
</li>
</ol>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
<img src="https://oracle.github.io/microservices-datadriven/cloudbank//cloudbank-logo.png" height="100px">
        </div>
        <script>
          window.index_js_url="/microservices-datadriven/cloudbank/searchindex.en.js?1741199486";
        </script>
        <search><form action="/microservices-datadriven/cloudbank/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="/microservices-datadriven/cloudbank/js/auto-complete.js?1741199486" defer></script>
        <script src="/microservices-datadriven/cloudbank/js/lunr/lunr.min.js?1741199486" defer></script>
        <script src="/microservices-datadriven/cloudbank/js/lunr/lunr.stemmer.support.min.js?1741199486" defer></script>
        <script src="/microservices-datadriven/cloudbank/js/lunr/lunr.multi.min.js?1741199486" defer></script>
        <script src="/microservices-datadriven/cloudbank/js/lunr/lunr.en.min.js?1741199486" defer></script>
        <script src="/microservices-datadriven/cloudbank/js/search.js?1741199486" defer></script>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <ul>
          <li><a class="padding" href="/microservices-datadriven/cloudbank/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
        </ul>
        <hr class="padding">
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div id="R-shortcutmenu-home" class="R-sidebarmenu">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/provision/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/provision/index.html">Provision an Instance</a><ul id="R-subsections-d6947c2d1078796b2bfd976ebc0e0264" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/devenv/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/devenv/index.html">Developer Environment</a><ul id="R-subsections-559c2972a719279af6301d7032063e64" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/account/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/account/index.html">Account Microservice</a><ul id="R-subsections-af4a17527840af40a6cda3fc650af51b" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-id="/microservices-datadriven/cloudbank/check/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/check/index.html">Check Processing</a><ul id="R-subsections-159f69b312555d5f0055ca241e6721e2" class="collapsible-menu">
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/check/intro/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/check/intro/index.html">Introduction</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/check/learn/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/check/learn/index.html">Learn about the scenario</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/check/update-account/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/check/update-account/index.html">Add Journal to the Account service</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/check/create-queues/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/check/create-queues/index.html">Create Queues in the Database</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/check/create-testrunner/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/check/create-testrunner/index.html">Create the Test Runner Microservice</a></li>
            <li class="active " data-nav-id="/microservices-datadriven/cloudbank/check/check-processing/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/check/check-processing/index.html">Create the Check Processing Microservice</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/check/test/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/check/test/index.html">Test the end-to-end flow</a></li></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/saga/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/index.html">Manage Sagas</a><ul id="R-subsections-dfd968a77748ad1f1a28d6a9118be66e" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/springai/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/springai/index.html">CloudBank AI Assistant</a><ul id="R-subsections-868fb0154339332ae87e7c98e3fa9bee" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/deploy-cli/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/deploy-cli/index.html">Deploy with the CLI</a><ul id="R-subsections-b839a8f6f0f5efd1be94b7f9da9e78d1" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/deploy-ide/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/deploy-ide/index.html">Deploy with an IDE</a><ul id="R-subsections-fd584c0da8f22ebe818df94300151866" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/backend/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/backend/index.html">Explore the Backend</a><ul id="R-subsections-f948b454f68385a53d2483b3c80424ae" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/cleanup/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/cleanup/index.html">Cleanup</a><ul id="R-subsections-6d9c3a2633de07dcbf4491d943578384" class="collapsible-menu"></ul></li>
          </ul>
        </div>
        <div id="R-shortcutmenu-shortcuts" class="R-sidebarmenu">
          <div class="nav-title padding">More</div>
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="https://github.com/oracle/microservices-datadriven"><a class="padding" href="https://github.com/oracle/microservices-datadriven" target="_blank"><i class='fa-fw fab fa-github'></i> GitHub repo</a></li>
            <li class="" data-nav-id="https://bit.ly/oraclespringboot"><a class="padding" href="https://bit.ly/oraclespringboot" target="_blank"><i class='fa-fw fas fa-bookmark'></i> Oracle Backend for Spring Boot and Microservices</a></li>
            <li class="" data-nav-id="https://github.com/oracle/spring-cloud-oracle"><a class="padding" href="https://github.com/oracle/spring-cloud-oracle" target="_blank"><i class='fa-fw fas fa-bookmark'></i> Spring Cloud Oracle</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/more/credits/"><a class="padding" href="/microservices-datadriven/cloudbank/more/credits/"><i class='fa-fw fas fa-bullhorn'></i> Credits</a></li>
          </ul>
        </div>
        <div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div>
        <div id="R-menu-footer">
          <hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter">
          <div id="R-prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks">
            <ul>
              <li id="R-select-language-container" class="footerLangSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-language"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-language">Language</label>
                    <select id="R-select-language" onchange="location = this.querySelector( this.value ).dataset.url;">
                      <option id="R-select-language-en" value="#R-select-language-en" data-url="/microservices-datadriven/cloudbank/check/check-processing/index.html" lang="en-us" selected></option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
              <li id="R-select-variant-container" class="footerVariantSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-paint-brush"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-variant">Theme</label>
                    <select id="R-select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                      <option id="R-select-variant-zen-light" value="zen-light" selected>Zen Light</option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
                <script>window.variants && variants.markSelectedVariant();</script>
              </li>
              <li class="footerVisitedLinks">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-history"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <button onclick="clearHistory();">Clear History</button>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
            </ul>
          </div>
          <div id="R-footer" class="footerFooter showFooter">
	    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://www.oracle.com/">Oracle</a></p>
		<p>Copyright &copy; 2022, 2024, <br>Oracle and/or its affiliates</p>
          </div>
        </div>
      </div>
    </aside>
    <script src="/microservices-datadriven/cloudbank/js/clipboard.min.js?1741199486" defer></script>
    <script src="/microservices-datadriven/cloudbank/js/perfect-scrollbar.min.js?1741199486" defer></script>
    <script src="/microservices-datadriven/cloudbank/js/theme.js?1741199486" defer></script>
  </body>
</html>
