<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/microservices-datadriven/cloudbank/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=microservices-datadriven/cloudbank/livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.140.1">
    <meta name="generator" content="Relearn 7.2.1">
    <meta name="description" content="The Data Access Object pattern is considered a best practice, and it allows separation of business logic from the persistence layer. In this task, you will create an Account Data Access Object (DAO) that hides the complexity of the persistence layer logic from the business layer services. Additionally, it establishes methods that can be reused by each business layer service that needs to operate on accounts - in this module there will be two such services - deposit and withdraw.">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Create a Data Access Object :: CloudBank AI">
    <meta name="twitter:description" content="The Data Access Object pattern is considered a best practice, and it allows separation of business logic from the persistence layer. In this task, you will create an Account Data Access Object (DAO) that hides the complexity of the persistence layer logic from the business layer services. Additionally, it establishes methods that can be reused by each business layer service that needs to operate on accounts - in this module there will be two such services - deposit and withdraw.">
    <meta property="og:url" content="http://localhost:1313/microservices-datadriven/cloudbank/saga/dao/index.html">
    <meta property="og:site_name" content="CloudBank AI">
    <meta property="og:title" content="Create a Data Access Object :: CloudBank AI">
    <meta property="og:description" content="The Data Access Object pattern is considered a best practice, and it allows separation of business logic from the persistence layer. In this task, you will create an Account Data Access Object (DAO) that hides the complexity of the persistence layer logic from the business layer services. Additionally, it establishes methods that can be reused by each business layer service that needs to operate on accounts - in this module there will be two such services - deposit and withdraw.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Manage Sagas">
    <meta itemprop="name" content="Create a Data Access Object :: CloudBank AI">
    <meta itemprop="description" content="The Data Access Object pattern is considered a best practice, and it allows separation of business logic from the persistence layer. In this task, you will create an Account Data Access Object (DAO) that hides the complexity of the persistence layer logic from the business layer services. Additionally, it establishes methods that can be reused by each business layer service that needs to operate on accounts - in this module there will be two such services - deposit and withdraw.">
    <meta itemprop="wordCount" content="806">
    <title>Create a Data Access Object :: CloudBank AI</title>
    <link href="/microservices-datadriven/cloudbank/images/favicon.png?1735243025" rel="icon" type="image/png">
    <link href="/microservices-datadriven/cloudbank/css/fontawesome-all.min.css?1735243025" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/microservices-datadriven/cloudbank/css/fontawesome-all.min.css?1735243025" rel="stylesheet"></noscript>
    <link href="/microservices-datadriven/cloudbank/css/auto-complete.css?1735243025" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/microservices-datadriven/cloudbank/css/auto-complete.css?1735243025" rel="stylesheet"></noscript>
    <link href="/microservices-datadriven/cloudbank/css/perfect-scrollbar.min.css?1735243025" rel="stylesheet">
    <link href="/microservices-datadriven/cloudbank/css/theme.css?1735243025" rel="stylesheet">
    <link href="/microservices-datadriven/cloudbank/css/format-html.css?1735243025" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..\/..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313\/microservices-datadriven\/cloudbank';
      window.relearn.min = ``;
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      // variant stuff
      window.relearn.themevariants = [ 'zen-light' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.localStorage.setItem(window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.localStorage.getItem(window.relearn.absBaseUri + "/variant");
        var select = document.querySelector("#R-select-variant");
        if (select) {
          select.value = variant;
        }
      }
      window.relearn.initVariant = function() {
        var variant = window.localStorage.getItem(window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.localStorage.setItem(window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-7HWQVTJ803"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-7HWQVTJ803');
        }
      </script>
  </head>
  <body class="mobile-support html" data-url="/microservices-datadriven/cloudbank/saga/dao/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper"> 
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/microservices-datadriven/cloudbank/index.html"><span itemprop="name">CloudBank AI</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/microservices-datadriven/cloudbank/saga/index.html"><span itemprop="name">Manage Sagas</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Create a Data Access Object</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/microservices-datadriven/cloudbank/saga/deposit/index.html" title="Create the Deposit service (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/microservices-datadriven/cloudbank/saga/business-logic/index.html" title="Implement business logic (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable saga" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="create-a-data-access-object">Create a Data Access Object</h1>

<p>The Data Access Object pattern is considered a best practice, and it allows separation of business logic from the persistence layer. In this task, you will create an Account Data Access Object (DAO) that hides the complexity of the persistence layer logic from the business layer services. Additionally, it establishes methods that can be reused by each business layer service that needs to operate on accounts - in this module there will be two such services - deposit and withdraw.</p>
<ol>
<li>
<p>Create the DAO class</p>
<p>Create a new Java file called <code>AccountTransferDAO.java</code> in <code>src/main/java/com/example/accounts/services</code>.  This class will contain common data access methods that are needed by multiple participants.  You will implement this class using the singleton pattern so that there will only be one instance of this class.</p>
<p>Here is the code to set up the class and implement the singleton pattern:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.example.accounts.services;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.accounts.model.Account;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.accounts.model.Journal;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.accounts.repository.AccountRepository;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.accounts.repository.JournalRepository;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.oracle.microtx.springboot.lra.annotation.ParticipantStatus;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> lombok.extern.slf4j.Slf4j;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.http.ResponseEntity;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.stereotype.Component;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@Component</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AccountTransferDAO</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> AccountTransferDAO singleton;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">final</span> AccountRepository accountRepository;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">final</span> JournalRepository journalRepository;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    * Initialize account and journal repository.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    * @param accountRepository Account Repository
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    * @param journalRepository Journal Repository
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    */</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">AccountTransferDAO</span>(AccountRepository accountRepository, JournalRepository journalRepository) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">accountRepository</span> <span style="color:#f92672">=</span> accountRepository;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">journalRepository</span> <span style="color:#f92672">=</span> journalRepository;
</span></span><span style="display:flex;"><span>        singleton <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>;
</span></span><span style="display:flex;"><span>        log.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;AccountTransferDAO accountsRepository = &#34;</span> <span style="color:#f92672">+</span> accountRepository 
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;, journalRepository = &#34;</span> <span style="color:#f92672">+</span> journalRepository);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> AccountTransferDAO <span style="color:#a6e22e">instance</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> singleton;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</li>
<li>
<p>Create a method to get the LRA status as a String</p>
<p>Create a <code>getStatusString</code> method which can be used to get a String representation of the LRA participant status.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Get status od LRA participant.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param status Status code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @return Returns status code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> String <span style="color:#a6e22e">getStatusString</span>(ParticipantStatus status) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">switch</span> (status) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> Compensated <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#34;Compensated&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> Completed <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#34;Completed&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> FailedToCompensate <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#34;Failed to Compensate&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> FailedToComplete <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#34;Failed to Complete&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> Active <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#34;Active&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> Compensating <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#34;Compensating&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> Completing <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#34;Completing&#34;</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">default</span> <span style="color:#f92672">-&gt;</span> <span style="color:#e6db74">&#34;Unknown&#34;</span>;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</li>
<li>
<p>Create a method to get the LRA status from a String</p>
<p>Create a <code>getStatusFromString</code> method to convert back from the String to the enum.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Get LRA Status from a string.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param statusString Status
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @return Participant Status
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> ParticipantStatus <span style="color:#a6e22e">getStatusFromString</span>(String statusString) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">switch</span> (statusString) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Compensated&#34;</span> <span style="color:#f92672">-&gt;</span> ParticipantStatus.<span style="color:#a6e22e">Compensated</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Completed&#34;</span> <span style="color:#f92672">-&gt;</span> ParticipantStatus.<span style="color:#a6e22e">Completed</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Failed to Compensate&#34;</span> <span style="color:#f92672">-&gt;</span> ParticipantStatus.<span style="color:#a6e22e">FailedToCompensate</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Failed to Complete&#34;</span> <span style="color:#f92672">-&gt;</span> ParticipantStatus.<span style="color:#a6e22e">FailedToComplete</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Active&#34;</span> <span style="color:#f92672">-&gt;</span> ParticipantStatus.<span style="color:#a6e22e">Active</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Compensating&#34;</span> <span style="color:#f92672">-&gt;</span> ParticipantStatus.<span style="color:#a6e22e">Compensating</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Completing&#34;</span> <span style="color:#f92672">-&gt;</span> ParticipantStatus.<span style="color:#a6e22e">Completing</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">default</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</li>
<li>
<p>Create a method to save an account</p>
<p>Create a method to save an account in the account repository.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">saveAccount</span>(Account account) {
</span></span><span style="display:flex;"><span>    log.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;saveAccount account&#34;</span> <span style="color:#f92672">+</span> account.<span style="color:#a6e22e">getAccountId</span>() <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; account&#34;</span> <span style="color:#f92672">+</span> account.<span style="color:#a6e22e">getAccountBalance</span>());
</span></span><span style="display:flex;"><span>    accountRepository.<span style="color:#a6e22e">save</span>(account);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Create a method to return the correct HTTP Status Code for an LRA status.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Return the correct HTTP Status Code for an LRA status
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param lraId LRA Id
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param journalType Journal Type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @return Participant Status
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @throws Exception Exception
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> ResponseEntity<span style="color:#f92672">&lt;</span>ParticipantStatus<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">status</span>(String lraId, String journalType) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>    Journal journal <span style="color:#f92672">=</span> getJournalForLRAid(lraId, journalType);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (AccountTransferDAO.<span style="color:#a6e22e">getStatusFromString</span>(journal.<span style="color:#a6e22e">getLraState</span>()).<span style="color:#a6e22e">equals</span>(ParticipantStatus.<span style="color:#a6e22e">Compensated</span>)) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ResponseEntity.<span style="color:#a6e22e">ok</span>(ParticipantStatus.<span style="color:#a6e22e">Compensated</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> ResponseEntity.<span style="color:#a6e22e">ok</span>(ParticipantStatus.<span style="color:#a6e22e">Completed</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</li>
<li>
<p>Create a method to update the LRA status in the journal</p>
<p>Create a method to update the LRA status in the journal table during the &ldquo;after LRA&rdquo; phase.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">/**
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * Update the LRA status in the journal table during the &#34;after LRA&#34; phase.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param lraId LRA Id
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param status Status
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @param journalType Journal Type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> * @throws Exception Exception
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"> */</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">afterLRA</span>(String lraId, String status, String journalType) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>    Journal journal <span style="color:#f92672">=</span> getJournalForLRAid(lraId, journalType);
</span></span><span style="display:flex;"><span>    journal.<span style="color:#a6e22e">setLraState</span>(status);
</span></span><span style="display:flex;"><span>    journalRepository.<span style="color:#a6e22e">save</span>(journal);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</li>
<li>
<p>Create methods to manage accounts</p>
<p>Create a method to get the account for a given account ID.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Account <span style="color:#a6e22e">getAccountForAccountId</span>(<span style="color:#66d9ef">long</span> accountId) {
</span></span><span style="display:flex;"><span>    Account account <span style="color:#f92672">=</span> accountRepository.<span style="color:#a6e22e">findByAccountId</span>(accountId);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (account <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> account;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Create a method to get the account that is related to a journal entry.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Account <span style="color:#a6e22e">getAccountForJournal</span>(Journal journal) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>    Account account <span style="color:#f92672">=</span> accountRepository.<span style="color:#a6e22e">findByAccountId</span>(journal.<span style="color:#a6e22e">getAccountId</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (account <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Exception(<span style="color:#e6db74">&#34;Invalid accountName:&#34;</span> <span style="color:#f92672">+</span> journal.<span style="color:#a6e22e">getAccountId</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> account;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Update <code>AccountRepository.java</code> in <code>src/main/java/com/example/accounts/repositories</code> to add these extra JPA methods.  Your updated file should look like this:</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.example.accounts.repository;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.List;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> org.springframework.data.jpa.repository.JpaRepository;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> com.example.accounts.model.Account;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">AccountRepository</span> <span style="color:#66d9ef">extends</span> JpaRepository<span style="color:#f92672">&lt;</span>Account, Long<span style="color:#f92672">&gt;</span> {   
</span></span><span style="display:flex;"><span>    List<span style="color:#f92672">&lt;</span>Account<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findByAccountCustomerId</span>(String customerId); 
</span></span><span style="display:flex;"><span>    List<span style="color:#f92672">&lt;</span>Account<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">findAccountsByAccountNameContains</span> (String accountName);
</span></span><span style="display:flex;"><span>    Account <span style="color:#a6e22e">findByAccountId</span>(<span style="color:#66d9ef">long</span> accountId);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
</li>
<li>
<p>Create methods to manage the journal</p>
<p>Back in the <code>AccountTransferDAO</code>, create a method to get the journal entry for a given LRA.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Journal <span style="color:#a6e22e">getJournalForLRAid</span>(String lraId, String journalType) <span style="color:#66d9ef">throws</span> Exception {
</span></span><span style="display:flex;"><span>    Journal journal <span style="color:#f92672">=</span> journalRepository.<span style="color:#a6e22e">findJournalByLraIdAndJournalType</span>(lraId, journalType);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (journal <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        journalRepository.<span style="color:#a6e22e">save</span>(<span style="color:#66d9ef">new</span> Journal(<span style="color:#e6db74">&#34;unknown&#34;</span>, <span style="color:#f92672">-</span>1, 0, lraId,
</span></span><span style="display:flex;"><span>                AccountTransferDAO.<span style="color:#a6e22e">getStatusString</span>(ParticipantStatus.<span style="color:#a6e22e">FailedToComplete</span>)));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> Exception(<span style="color:#e6db74">&#34;Journal entry does not exist for lraId:&#34;</span> <span style="color:#f92672">+</span> lraId);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> journal;
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>Create a method to save a journal entry.</p>
<div class="highlight wrap-code"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">saveJournal</span>(Journal journal) {
</span></span><span style="display:flex;"><span>    journalRepository.<span style="color:#a6e22e">save</span>(journal);
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div>
<p>This completes the Data Access Object, now you can start implementing the actual business logic for the services.</p>
</li>
</ol>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
<img src="http://localhost:1313/microservices-datadriven/cloudbank//cloudbank-logo.png" height="100px">
        </div>
        <script>
          window.index_js_url="/microservices-datadriven/cloudbank/searchindex.en.js?1735243025";
        </script>
        <search><form action="/microservices-datadriven/cloudbank/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="/microservices-datadriven/cloudbank/js/auto-complete.js?1735243025" defer></script>
        <script src="/microservices-datadriven/cloudbank/js/lunr/lunr.min.js?1735243025" defer></script>
        <script src="/microservices-datadriven/cloudbank/js/lunr/lunr.stemmer.support.min.js?1735243025" defer></script>
        <script src="/microservices-datadriven/cloudbank/js/lunr/lunr.multi.min.js?1735243025" defer></script>
        <script src="/microservices-datadriven/cloudbank/js/lunr/lunr.en.min.js?1735243025" defer></script>
        <script src="/microservices-datadriven/cloudbank/js/search.js?1735243025" defer></script>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <ul>
          <li><a class="padding" href="/microservices-datadriven/cloudbank/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
        </ul>
        <hr class="padding">
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div id="R-shortcutmenu-home" class="R-sidebarmenu">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/provision/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/provision/index.html">Provision an Instance</a><ul id="R-subsections-d6947c2d1078796b2bfd976ebc0e0264" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/devenv/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/devenv/index.html">Developer Environment</a><ul id="R-subsections-559c2972a719279af6301d7032063e64" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/account/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/account/index.html">Account Microservice</a><ul id="R-subsections-af4a17527840af40a6cda3fc650af51b" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/check/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/check/index.html">Check Processing</a><ul id="R-subsections-159f69b312555d5f0055ca241e6721e2" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-id="/microservices-datadriven/cloudbank/saga/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/index.html">Manage Sagas</a><ul id="R-subsections-dfd968a77748ad1f1a28d6a9118be66e" class="collapsible-menu">
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/saga/intro/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/intro/index.html">Introduction</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/saga/learn/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/learn/index.html">Learn about the Saga pattern</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/saga/learn-lra/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/learn-lra/index.html">Learn about Long Running Actions</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/saga/prepare/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/prepare/index.html">Prepare the Account service</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/saga/deposit/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/deposit/index.html">Create the Deposit service</a></li>
            <li class="active " data-nav-id="/microservices-datadriven/cloudbank/saga/dao/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/dao/index.html">Create a Data Access Object</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/saga/business-logic/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/business-logic/index.html">Implement business logic</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/saga/withdraw-service/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/withdraw-service/index.html">Create the Withdrawal service</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/saga/transfer-service/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/transfer-service/index.html">Create the Transfer service</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/saga/deploy/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/deploy/index.html">Deploy services</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/saga/test/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/saga/test/index.html">Run LRA test cases</a></li></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/springai/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/springai/index.html">CloudBank AI Assistant</a><ul id="R-subsections-868fb0154339332ae87e7c98e3fa9bee" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/deploy-cli/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/deploy-cli/index.html">Deploy with the CLI</a><ul id="R-subsections-b839a8f6f0f5efd1be94b7f9da9e78d1" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/deploy-ide/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/deploy-ide/index.html">Deploy with an IDE</a><ul id="R-subsections-fd584c0da8f22ebe818df94300151866" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/backend/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/backend/index.html">Explore the Backend</a><ul id="R-subsections-f948b454f68385a53d2483b3c80424ae" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/cleanup/index.html"><a class="padding" href="/microservices-datadriven/cloudbank/cleanup/index.html">Cleanup</a><ul id="R-subsections-6d9c3a2633de07dcbf4491d943578384" class="collapsible-menu"></ul></li>
          </ul>
        </div>
        <div id="R-shortcutmenu-shortcuts" class="R-sidebarmenu">
          <div class="nav-title padding">More</div>
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="https://github.com/oracle/microservices-datadriven"><a class="padding" href="https://github.com/oracle/microservices-datadriven" target="_blank"><i class='fa-fw fab fa-github'></i> GitHub repo</a></li>
            <li class="" data-nav-id="https://bit.ly/oraclespringboot"><a class="padding" href="https://bit.ly/oraclespringboot" target="_blank"><i class='fa-fw fas fa-bookmark'></i> Oracle Backend for Spring Boot and Microservices</a></li>
            <li class="" data-nav-id="https://github.com/oracle/spring-cloud-oracle"><a class="padding" href="https://github.com/oracle/spring-cloud-oracle" target="_blank"><i class='fa-fw fas fa-bookmark'></i> Spring Cloud Oracle</a></li>
            <li class="" data-nav-id="/microservices-datadriven/cloudbank/more/credits/"><a class="padding" href="/microservices-datadriven/cloudbank/more/credits/"><i class='fa-fw fas fa-bullhorn'></i> Credits</a></li>
          </ul>
        </div>
        <div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter"></div>
        <div id="R-menu-footer">
          <hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showFooter">
          <div id="R-prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks">
            <ul>
              <li id="R-select-language-container" class="footerLangSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-language"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-language">Language</label>
                    <select id="R-select-language" onchange="location = this.querySelector( this.value ).dataset.url;">
                      <option id="R-select-language-en" value="#R-select-language-en" data-url="/microservices-datadriven/cloudbank/saga/dao/index.html" lang="en-us" selected></option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
              <li id="R-select-variant-container" class="footerVariantSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-paint-brush"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-variant">Theme</label>
                    <select id="R-select-variant" onchange="window.relearn.changeVariant( this.value );">
                      <option id="R-select-variant-zen-light" value="zen-light" selected>Zen Light</option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
                <script>window.relearn.markVariant();</script>
              </li>
              <li class="footerVisitedLinks">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-history"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <button onclick="clearHistory();">Clear History</button>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
            </ul>
          </div>
          <div id="R-footer" class="footerFooter showFooter">
	    <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://www.oracle.com/">Oracle</a></p>
		<p>Copyright &copy; 2022, 2024, <br>Oracle and/or its affiliates</p>
          </div>
        </div>
      </div>
    </aside>
    <script src="/microservices-datadriven/cloudbank/js/clipboard.min.js?1735243025" defer></script>
    <script src="/microservices-datadriven/cloudbank/js/perfect-scrollbar.min.js?1735243025" defer></script>
    <script src="/microservices-datadriven/cloudbank/js/theme.js?1735243025" defer></script>
  </body>
</html>
