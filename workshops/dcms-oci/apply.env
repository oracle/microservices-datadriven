#!/bin/bash
# Copyright (c) 2021 Oracle and/or its affiliates.
# Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.

if ! provisioning-helper-pre-apply-env; then
  return 1
fi

export DCMS_STATE=$MY_STATE
source $MY_CODE/source.env


# Make sure folders are created
mkdir -p $DCMS_LOG_DIR $DCMS_INFRA_STATE $DCMS_APP_STATE $DCMS_THREAD_STATE 


# Create the state store
STATE_STORE=$DCMS_INFRA_STATE/state_store
mkdir -p $STATE_STORE
echo "STATE_LOG='$DCMS_LOG_DIR/state.log'" > $STATE_STORE/input.env
cd $STATE_STORE
provisioning-apply $MSDD_INFRA_CODE/state_store


# Create the vault
VAULT=$DCMS_INFRA_STATE/vault
mkdir -p $VAULT
cd $VAULT
provisioning-apply $MSDD_INFRA_CODE/vault/folder