"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[262],{6951(e,r,a){a.r(r),a.d(r,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"platform/strimzi_operator","title":"Strimzi Kafka Operator","description":"Strimzi Kafka Operator","source":"@site/docs/platform/strimzi_operator.md","sourceDirName":"platform","slug":"/platform/strimzi_operator","permalink":"/microservices-datadriven/obaas/docs/platform/strimzi_operator","draft":false,"unlisted":false,"editUrl":"https://github.com/oracle/microservices-datadriven/tree/main/docs-source/site/docs/platform/strimzi_operator.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Strimzi Kafka Operator","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Apache APISIX","permalink":"/microservices-datadriven/obaas/docs/platform/apacheapisix"},"next":{"title":"Coherence Operator","permalink":"/microservices-datadriven/obaas/docs/platform/coherence"}}');var t=a(4848),s=a(8453);const i={title:"Strimzi Kafka Operator",sidebar_position:2},o=void 0,c={},l=[{value:"Strimzi Kafka Operator",id:"strimzi-kafka-operator",level:2},{value:"Installing the Strimzi Kafka Operator",id:"installing-the-strimzi-kafka-operator",level:3},{value:"Creating a Kafka Cluster",id:"creating-a-kafka-cluster",level:3},{value:"Prerequisites",id:"prerequisites",level:4},{value:"Step 1: Create the Kafka Cluster YAML",id:"step-1-create-the-kafka-cluster-yaml",level:4},{value:"Step 2: Deploy the Cluster",id:"step-2-deploy-the-cluster",level:4},{value:"Step 3: Verify the Deployment",id:"step-3-verify-the-deployment",level:4},{value:"Creating a Kafka Topic",id:"creating-a-kafka-topic",level:3},{value:"Testing with a Producer and Consumer",id:"testing-with-a-producer-and-consumer",level:3},{value:"Strimzi Custom Resources Reference",id:"strimzi-custom-resources-reference",level:3}];function d(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h2,{id:"strimzi-kafka-operator",children:"Strimzi Kafka Operator"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.a,{href:"https://strimzi.io/",children:"Strimzi"})," is an open-source operator that simplifies running Apache Kafka on Kubernetes. It extends Kubernetes with Custom Resources (CRDs) to declaratively manage Kafka clusters, topics, and users. ",(0,t.jsx)(r.a,{href:"https://strimzi.io/docs/operators/latest/overview",children:"Full documentation can be found here"})]}),"\n",(0,t.jsxs)(r.p,{children:["Oracle Backend for Microservices and AI deploys the operator as a cluster-scoped component via the ",(0,t.jsx)(r.code,{children:"obaas-prereqs"})," Helm chart. Once installed, you can create Kafka clusters in any namespace by applying Strimzi custom resources."]}),"\n",(0,t.jsx)(r.h3,{id:"installing-the-strimzi-kafka-operator",children:"Installing the Strimzi Kafka Operator"}),"\n",(0,t.jsxs)(r.p,{children:["The Strimzi Kafka Operator is installed if ",(0,t.jsx)(r.code,{children:"strimzi.enabled"})," is set to ",(0,t.jsx)(r.code,{children:"true"})," in the ",(0,t.jsx)(r.code,{children:"values.yaml"})," file. The operator is deployed cluster-wide and manages Kafka custom resources across all namespaces."]}),"\n",(0,t.jsx)(r.h3,{id:"creating-a-kafka-cluster",children:"Creating a Kafka Cluster"}),"\n",(0,t.jsxs)(r.p,{children:["Follow these steps to create a single-node Kafka cluster named ",(0,t.jsx)(r.code,{children:"my-cluster"})," in a given namespace."]}),"\n",(0,t.jsx)(r.h4,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Strimzi Kafka Operator is installed and running"}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"kubectl"})," is configured to access your Kubernetes cluster"]}),"\n",(0,t.jsxs)(r.li,{children:["A namespace where you want to deploy the cluster (examples below use ",(0,t.jsx)(r.code,{children:"my-namespace"}),")"]}),"\n"]}),"\n",(0,t.jsx)(r.h4,{id:"step-1-create-the-kafka-cluster-yaml",children:"Step 1: Create the Kafka Cluster YAML"}),"\n",(0,t.jsxs)(r.p,{children:["Create a file named ",(0,t.jsx)(r.code,{children:"kafka-cluster.yaml"}),". This defines a single-node KRaft-based cluster suitable for development and testing:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:"apiVersion: kafka.strimzi.io/v1beta2\nkind: KafkaNodePool\nmetadata:\n  name: dual-role\n  labels:\n    strimzi.io/cluster: my-cluster\nspec:\n  replicas: 1\n  roles:\n    - controller\n    - broker\n  storage:\n    type: jbod\n    volumes:\n      - id: 0\n        type: persistent-claim\n        size: 100Gi\n        deleteClaim: false\n        kraftMetadata: shared\n---\napiVersion: kafka.strimzi.io/v1beta2\nkind: Kafka\nmetadata:\n  name: my-cluster\n  annotations:\n    strimzi.io/node-pools: enabled\n    strimzi.io/kraft: enabled\nspec:\n  kafka:\n    version: 3.9.0\n    metadataVersion: 3.9-IV0\n    listeners:\n      - name: plain\n        port: 9092\n        type: internal\n        tls: false\n      - name: tls\n        port: 9093\n        type: internal\n        tls: true\n    config:\n      offsets.topic.replication.factor: 1\n      transaction.state.log.replication.factor: 1\n      transaction.state.log.min.isr: 1\n      default.replication.factor: 1\n      min.insync.replicas: 1\n  entityOperator:\n    topicOperator: {}\n    userOperator: {}\n"})}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Notes:"})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["This uses ",(0,t.jsx)(r.strong,{children:"KRaft mode"})," (Kafka Raft) \u2014 no ZooKeeper required"]}),"\n",(0,t.jsxs)(r.li,{children:["The ",(0,t.jsx)(r.code,{children:"dual-role"})," node pool runs both controller and broker roles on a single node"]}),"\n",(0,t.jsxs)(r.li,{children:["Replication factors are set to 1 for single-node operation \u2014 for production, increase ",(0,t.jsx)(r.code,{children:"replicas"})," and replication factors to 3+"]}),"\n",(0,t.jsxs)(r.li,{children:["Two listeners are configured: ",(0,t.jsx)(r.code,{children:"plain"})," (port 9092, no TLS) and ",(0,t.jsx)(r.code,{children:"tls"})," (port 9093, encrypted)"]}),"\n",(0,t.jsxs)(r.li,{children:["The ",(0,t.jsx)(r.code,{children:"entityOperator"})," enables the Topic Operator and User Operator for declarative topic and user management"]}),"\n"]}),"\n",(0,t.jsx)(r.h4,{id:"step-2-deploy-the-cluster",children:"Step 2: Deploy the Cluster"}),"\n",(0,t.jsx)(r.p,{children:"Apply the YAML to your namespace:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"kubectl apply -f kafka-cluster.yaml -n my-namespace\n"})}),"\n",(0,t.jsx)(r.p,{children:"Wait for the cluster to be ready:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"kubectl wait kafka/my-cluster --for=condition=Ready --timeout=300s -n my-namespace\n"})}),"\n",(0,t.jsx)(r.h4,{id:"step-3-verify-the-deployment",children:"Step 3: Verify the Deployment"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Check the Kafka resource status\nkubectl get kafka -n my-namespace\n\n# Check that pods are running\nkubectl get pods -n my-namespace\n\n# View cluster details\nkubectl describe kafka my-cluster -n my-namespace\n"})}),"\n",(0,t.jsx)(r.h3,{id:"creating-a-kafka-topic",children:"Creating a Kafka Topic"}),"\n",(0,t.jsxs)(r.p,{children:["Once your cluster is running, create topics declaratively using the ",(0,t.jsx)(r.code,{children:"KafkaTopic"})," resource."]}),"\n",(0,t.jsxs)(r.p,{children:["Create a file named ",(0,t.jsx)(r.code,{children:"my-topic.yaml"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:"apiVersion: kafka.strimzi.io/v1beta2\nkind: KafkaTopic\nmetadata:\n  name: my-topic\n  labels:\n    strimzi.io/cluster: my-cluster\nspec:\n  partitions: 1\n  replicas: 1\n  config:\n    retention.ms: 7200000\n    segment.bytes: 1073741824\n"})}),"\n",(0,t.jsx)(r.p,{children:"Apply it:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"kubectl apply -f my-topic.yaml -n my-namespace\n"})}),"\n",(0,t.jsx)(r.p,{children:"Verify the topic was created:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"kubectl get kafkatopic -n my-namespace\n"})}),"\n",(0,t.jsx)(r.h3,{id:"testing-with-a-producer-and-consumer",children:"Testing with a Producer and Consumer"}),"\n",(0,t.jsx)(r.p,{children:"You can quickly test your cluster using the Kafka console tools:"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Start a producer"})," (type messages and press Enter to send):"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"kubectl -n my-namespace run kafka-producer -ti \\\n  --image=quay.io/strimzi/kafka:0.45.0-kafka-3.9.0 \\\n  --rm=true --restart=Never -- \\\n  bin/kafka-console-producer.sh \\\n    --bootstrap-server my-cluster-kafka-bootstrap:9092 \\\n    --topic my-topic\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Start a consumer"})," (in a separate terminal):"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"kubectl -n my-namespace run kafka-consumer -ti \\\n  --image=quay.io/strimzi/kafka:0.45.0-kafka-3.9.0 \\\n  --rm=true --restart=Never -- \\\n  bin/kafka-console-consumer.sh \\\n    --bootstrap-server my-cluster-kafka-bootstrap:9092 \\\n    --topic my-topic \\\n    --from-beginning\n"})}),"\n",(0,t.jsx)(r.h3,{id:"strimzi-custom-resources-reference",children:"Strimzi Custom Resources Reference"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Resource"}),(0,t.jsx)(r.th,{children:"Purpose"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"Kafka"})}),(0,t.jsx)(r.td,{children:"Defines the Kafka cluster configuration"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"KafkaNodePool"})}),(0,t.jsx)(r.td,{children:"Manages groups of Kafka nodes with specific roles"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"KafkaTopic"})}),(0,t.jsx)(r.td,{children:"Declaratively manages Kafka topics"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"KafkaUser"})}),(0,t.jsx)(r.td,{children:"Manages user authentication and authorization"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"KafkaConnect"})}),(0,t.jsx)(r.td,{children:"Deploys Kafka Connect for data integration"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.code,{children:"KafkaBridge"})}),(0,t.jsx)(r.td,{children:"Provides HTTP API access to Kafka"})]})]})]}),"\n",(0,t.jsxs)(r.p,{children:["For the full custom resource reference, see the ",(0,t.jsx)(r.a,{href:"https://strimzi.io/docs/operators/latest/configuring",children:"Strimzi documentation"}),"."]})]})}function p(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,r,a){a.d(r,{R:()=>i,x:()=>o});var n=a(6540);const t={},s=n.createContext(t);function i(e){const r=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),n.createElement(s.Provider,{value:r},e.children)}}}]);