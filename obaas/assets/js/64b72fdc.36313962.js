"use strict";(globalThis.webpackChunksite=globalThis.webpackChunksite||[]).push([[111],{7706(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"deploy/deploy","title":"Deploying an Application to OBaaS","description":"This guide walks through deploying an application to Oracle Backend for Microservices and AI (OBaaS). It covers each step from creating container repositories through exposing services via the API gateway.","source":"@site/docs/deploy/deploy.md","sourceDirName":"deploy","slug":"/deploy/","permalink":"/microservices-datadriven/obaas/docs/deploy/","draft":false,"unlisted":false,"editUrl":"https://github.com/oracle/microservices-datadriven/tree/main/docs-source/site/docs/deploy/deploy.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Deploying an Application to OBaaS","sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Deployment Overview","permalink":"/microservices-datadriven/obaas/docs/deploy/overview"},"next":{"title":"Platform Services Overview","permalink":"/microservices-datadriven/obaas/docs/platform/"}}');var a=s(4848),i=s(8453);const t={title:"Deploying an Application to OBaaS",sidebar_position:5},l="Deploying an Application to OBaaS",d={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Create Container Repositories",id:"step-1-create-container-repositories",level:2},{value:"Step 2: Build and Push Container Images",id:"step-2-build-and-push-container-images",level:2},{value:"Configure JKube in Your pom.xml",id:"configure-jkube-in-your-pomxml",level:3},{value:"Build Dependencies",id:"build-dependencies",level:3},{value:"Build and Push",id:"build-and-push",level:3},{value:"Step 3: Create Database Secrets",id:"step-3-create-database-secrets",level:2},{value:"Secret Naming Convention",id:"secret-naming-convention",level:3},{value:"Create the Privileged Secret",id:"create-the-privileged-secret",level:3},{value:"Create Application Secrets",id:"create-application-secrets",level:3},{value:"Verify Secrets",id:"verify-secrets",level:3},{value:"Step 4: Deploy with Helm",id:"step-4-deploy-with-helm",level:2},{value:"Add the Helm Repository",id:"add-the-helm-repository",level:3},{value:"Identify the OBaaS Release Name",id:"identify-the-obaas-release-name",level:3},{value:"Create a values.yaml",id:"create-a-valuesyaml",level:3},{value:"Helm Values Reference",id:"helm-values-reference",level:3},{value:"Deploy a Service",id:"deploy-a-service",level:3},{value:"What Gets Deployed",id:"what-gets-deployed",level:3},{value:"Verify the Deployment",id:"verify-the-deployment",level:3},{value:"Upgrade and Uninstall",id:"upgrade-and-uninstall",level:3},{value:"Step 5: Create API Gateway Routes",id:"step-5-create-api-gateway-routes",level:2},{value:"Get the APISIX Admin Key",id:"get-the-apisix-admin-key",level:3},{value:"Port-Forward to the Admin API",id:"port-forward-to-the-admin-api",level:3},{value:"Create a Route",id:"create-a-route",level:3},{value:"Verify the Route",id:"verify-the-route",level:3},{value:"Stop Port-Forward",id:"stop-port-forward",level:3},{value:"Summary",id:"summary",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"deploying-an-application-to-obaas",children:"Deploying an Application to OBaaS"})}),"\n",(0,a.jsx)(n.p,{children:"This guide walks through deploying an application to Oracle Backend for Microservices and AI (OBaaS). It covers each step from creating container repositories through exposing services via the API gateway."}),"\n",(0,a.jsxs)(n.p,{children:["The steps below are generic \u2014 replace placeholder values like ",(0,a.jsx)(n.code,{children:"my-app"}),", ",(0,a.jsx)(n.code,{children:"my-service"}),", and ",(0,a.jsx)(n.code,{children:"mydb"})," with values appropriate to your application."]}),"\n",(0,a.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsx)(n.p,{children:"Before you begin, ensure the following tools are installed and configured:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Tool"}),(0,a.jsx)(n.th,{children:"Purpose"}),(0,a.jsx)(n.th,{children:"Verify"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Java"})}),(0,a.jsx)(n.td,{children:"Build application JARs"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"java -version"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Maven"})}),(0,a.jsx)(n.td,{children:"Build and package"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"mvn --version"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Docker"})}),(0,a.jsx)(n.td,{children:"Build and push container images"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"docker ps"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"kubectl"})}),(0,a.jsx)(n.td,{children:"Interact with Kubernetes cluster"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"kubectl cluster-info"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"Helm"})}),(0,a.jsx)(n.td,{children:"Deploy applications to Kubernetes"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"helm version"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.strong,{children:"OCI CLI"})}),(0,a.jsx)(n.td,{children:"Manage OCI resources (if using OCIR)"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"oci --version"})})]})]})]}),"\n",(0,a.jsx)(n.p,{children:"Additional requirements:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"JAVA_HOME"})," must be set and point to your Java installation"]}),"\n",(0,a.jsx)(n.li,{children:"Docker daemon must be running"}),"\n",(0,a.jsxs)(n.li,{children:["kubectl must be connected to the target cluster (",(0,a.jsx)(n.code,{children:"kubectl config current-context"}),")"]}),"\n",(0,a.jsx)(n.li,{children:"OBaaS platform must already be installed in your target namespace"}),"\n"]}),"\n",(0,a.jsxs)(n.admonition,{type:"tip",children:[(0,a.jsx)(n.p,{children:"If you are using OCI Container Registry (OCIR), configure the OCI CLI first:"}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"oci setup config\n"})}),(0,a.jsxs)(n.p,{children:["The registry URL is derived from your OCI region and namespace: ",(0,a.jsx)(n.code,{children:"<region>.ocir.io/<namespace>"}),"."]})]}),"\n",(0,a.jsx)(n.h2,{id:"step-1-create-container-repositories",children:"Step 1: Create Container Repositories"}),"\n",(0,a.jsxs)(n.p,{children:["Each microservice needs a container repository to store its image. Create one repository per service in your container registry of choice \u2014 OCI Container Registry (OCIR), Amazon ECR, Azure Container Registry, Google Artifact Registry, Docker Hub, GitHub Container Registry, or any Docker V2-compatible registry. Use your provider's CLI or console to create the repositories, then authenticate Docker with ",(0,a.jsx)(n.code,{children:"docker login"}),". The registry URL format varies by provider; consult your provider's documentation for the correct path. The rest of this guide works the same regardless of which registry you use."]}),"\n",(0,a.jsx)(n.p,{children:"The example below shows how to create repositories in OCI Container Registry. Adapt to your registry as needed."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Set your variables\nCOMPARTMENT="my-compartment"\nPREFIX="my-app"\n\n# Get your compartment OCID\nCOMPARTMENT_OCID=$(oci iam compartment list --all \\\n  --compartment-id-in-subtree true \\\n  --query "data[?name==\'${COMPARTMENT}\'].id | [0]" \\\n  --raw-output)\n\n# Create a repository for each service\nfor SERVICE in service1 service2 service3; do\n  oci artifacts container repository create \\\n    --compartment-id "$COMPARTMENT_OCID" \\\n    --display-name "${PREFIX}/${SERVICE}" \\\n    --is-public true\ndone\n'})}),"\n",(0,a.jsx)(n.p,{children:"After creating the repositories, authenticate Docker to your registry:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"docker login <registry-host>\n"})}),"\n",(0,a.jsx)(n.h2,{id:"step-2-build-and-push-container-images",children:"Step 2: Build and Push Container Images"}),"\n",(0,a.jsx)(n.h3,{id:"configure-jkube-in-your-pomxml",children:"Configure JKube in Your pom.xml"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"obaas-sample-app"})," Helm chart expects a standard container image. Use ",(0,a.jsx)(n.a,{href:"https://eclipse.dev/jkube/",children:"Eclipse JKube"})," to build and push images with Maven."]}),"\n",(0,a.jsxs)(n.p,{children:["Add the JKube plugin to each service's ",(0,a.jsx)(n.code,{children:"pom.xml"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:"<plugin>\n  <groupId>org.eclipse.jkube</groupId>\n  <artifactId>kubernetes-maven-plugin</artifactId>\n  <version>1.18.2</version>\n  <configuration>\n    <images>\n      <image>\n        \x3c!-- highlight-next-line --\x3e\n        <name>${image.registry}/${project.artifactId}:${project.version}</name>\n        <build>\n          <from>ghcr.io/oracle/openjdk-image-obaas:21</from>\n          <assembly>\n            <mode>dir</mode>\n            <targetDir>/deployments</targetDir>\n          </assembly>\n          <cmd>java -jar /deployments/${project.artifactId}-${project.version}.jar</cmd>\n        </build>\n      </image>\n    </images>\n  </configuration>\n</plugin>\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Replace the ",(0,a.jsx)(n.code,{children:"<name>"})," value with your registry path. The ",(0,a.jsx)(n.code,{children:"${image.registry}"})," property can be passed on the command line with ",(0,a.jsx)(n.code,{children:"-Dimage.registry=..."}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"build-dependencies",children:"Build Dependencies"}),"\n",(0,a.jsx)(n.p,{children:"If your project has shared modules (parent POM, common libraries, build tools), install them to your local Maven repository first:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Install parent POM\nmvn clean install -N\n\n# Install shared modules (adjust module names to your project)\nmvn clean install -pl common\n"})}),"\n",(0,a.jsx)(n.h3,{id:"build-and-push",children:"Build and Push"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Set your registry path\nREGISTRY="<region>.ocir.io/<namespace>/my-app"\n\n# Build the JAR\nmvn clean package -DskipTests -pl my-service\n\n# Build the container image\nmvn org.eclipse.jkube:kubernetes-maven-plugin:build \\\n  -pl my-service \\\n  -Dimage.registry=$REGISTRY\n\n# Push to registry\nmvn org.eclipse.jkube:kubernetes-maven-plugin:push \\\n  -pl my-service \\\n  -Dimage.registry=$REGISTRY\n'})}),"\n",(0,a.jsx)(n.p,{children:"Or combine build and push in a single command:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mvn clean package k8s:build k8s:push \\\n  -DskipTests \\\n  -pl my-service \\\n  -Dimage.registry=$REGISTRY\n"})}),"\n",(0,a.jsxs)(n.admonition,{type:"tip",children:[(0,a.jsxs)(n.p,{children:["To build and push all services at once, pass a comma-separated list to ",(0,a.jsx)(n.code,{children:"-pl"}),":"]}),(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mvn clean package k8s:build k8s:push \\\n  -DskipTests \\\n  -pl service1,service2,service3 \\\n  -Dimage.registry=$REGISTRY\n"})})]}),"\n",(0,a.jsx)(n.h2,{id:"step-3-create-database-secrets",children:"Step 3: Create Database Secrets"}),"\n",(0,a.jsx)(n.p,{children:"If your application connects to an Oracle database, you need to create Kubernetes secrets containing the database credentials. The Helm chart uses these secrets to configure datasource environment variables and to run a database initialization job."}),"\n",(0,a.jsx)(n.h3,{id:"secret-naming-convention",children:"Secret Naming Convention"}),"\n",(0,a.jsx)(n.p,{children:"The Helm chart expects secrets following this naming pattern:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Secret"}),(0,a.jsx)(n.th,{children:"Purpose"}),(0,a.jsx)(n.th,{children:"Keys"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"{dbname}-db-priv-authn"})}),(0,a.jsx)(n.td,{children:"Privileged credentials (for creating users, Liquibase)"}),(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"username"}),", ",(0,a.jsx)(n.code,{children:"password"}),", ",(0,a.jsx)(n.code,{children:"service"})]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"{dbname}-{service}-db-authn"})}),(0,a.jsx)(n.td,{children:"Application credentials (per service)"}),(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"username"}),", ",(0,a.jsx)(n.code,{children:"password"}),", ",(0,a.jsx)(n.code,{children:"service"})]})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"create-the-privileged-secret",children:"Create the Privileged Secret"}),"\n",(0,a.jsx)(n.p,{children:"The privileged secret must exist before deploying. It is typically created during OBaaS platform setup. If it does not exist, create it manually:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl -n <namespace> create secret generic <dbname>-db-priv-authn \\\n  --from-literal=username=ADMIN \\\n  --from-literal=password='<admin-password>' \\\n  --from-literal=service=<dbname>_tp\n"})}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"service"})," value is the TNS service name for your database (for example, ",(0,a.jsx)(n.code,{children:"mydb_tp"}),")."]}),"\n",(0,a.jsx)(n.h3,{id:"create-application-secrets",children:"Create Application Secrets"}),"\n",(0,a.jsx)(n.p,{children:"Create a secret for each distinct database user your application needs. Services that share a schema can share a secret."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl -n <namespace> create secret generic <dbname>-<service>-db-authn \\\n  --from-literal=username=<SERVICE_USERNAME> \\\n  --from-literal=password='<service-password>' \\\n  --from-literal=service=<dbname>_tp\n"})}),"\n",(0,a.jsxs)(n.admonition,{title:"Oracle Password Requirements",type:"info",children:[(0,a.jsx)(n.p,{children:"Oracle database passwords must meet the following rules:"}),(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"12\u201330 characters"}),"\n",(0,a.jsxs)(n.li,{children:["At least two uppercase letters, two lowercase letters, two digits, and two special characters (",(0,a.jsx)(n.code,{children:"#"})," or ",(0,a.jsx)(n.code,{children:"_"}),")"]}),"\n",(0,a.jsx)(n.li,{children:"Cannot start with a digit or special character"}),"\n",(0,a.jsx)(n.li,{children:"Cannot contain the username"}),"\n"]}),(0,a.jsx)(n.p,{children:"Oracle usernames are stored as uppercase by default."})]}),"\n",(0,a.jsx)(n.h3,{id:"verify-secrets",children:"Verify Secrets"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# List all database secrets\nkubectl get secrets -n <namespace> | grep db-authn\n\n# View a secret's keys (not values)\nkubectl describe secret <dbname>-<service>-db-authn -n <namespace>\n\n# Decode a specific value\nkubectl get secret <dbname>-<service>-db-authn -n <namespace> \\\n  -o jsonpath='{.data.password}' | base64 -d\n"})}),"\n",(0,a.jsx)(n.h2,{id:"step-4-deploy-with-helm",children:"Step 4: Deploy with Helm"}),"\n",(0,a.jsx)(n.h3,{id:"add-the-helm-repository",children:"Add the Helm Repository"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"obaas-sample-app"})," Helm chart is published in the OBaaS Helm repository:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"helm repo add obaas https://oracle.github.io/microservices-datadriven/helm\nhelm repo update\n"})}),"\n",(0,a.jsx)(n.p,{children:"Verify the chart is available:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"helm search repo obaas/obaas-sample-app\n"})}),"\n",(0,a.jsx)(n.h3,{id:"identify-the-obaas-release-name",children:"Identify the OBaaS Release Name"}),"\n",(0,a.jsx)(n.p,{children:"The Helm chart needs to know the OBaaS platform release name to derive service endpoints (Eureka, OTEL collector, APISIX, etc.). Find it with:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"helm list -n <namespace>\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Look for the release that is ",(0,a.jsx)(n.strong,{children:"not"})," an application deployment (i.e., not using the ",(0,a.jsx)(n.code,{children:"obaas-sample-app"})," chart). This is your OBaaS platform release name."]}),"\n",(0,a.jsx)(n.h3,{id:"create-a-valuesyaml",children:"Create a values.yaml"}),"\n",(0,a.jsxs)(n.p,{children:["Create a ",(0,a.jsx)(n.code,{children:"values.yaml"})," for each service you want to deploy. Here is a minimal example for a Spring Boot service:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'fullnameOverride: "my-service"\n\nimage:\n  repository: "<region>.ocir.io/<namespace>/my-app/my-service"\n  tag: "0.0.1-SNAPSHOT"\n\nobaas:\n  releaseName: "<obaas-release-name>"\n  framework: "SPRING_BOOT"\n\ndatabase:\n  name: "<dbname>"\n\neureka:\n  enabled: true\n\notel:\n  enabled: true\n\notmm:\n  enabled: false\n'})}),"\n",(0,a.jsxs)(n.p,{children:["For a Helidon service, set ",(0,a.jsx)(n.code,{children:'framework: "HELIDON"'})," and add the required Helidon values:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'obaas:\n  framework: "HELIDON"\n\nhelidon:\n  datasource:\n    name: "myDatasource"       # Must match application.yaml\n  otel:\n    serviceName: "my-service"\n'})}),"\n",(0,a.jsx)(n.h3,{id:"helm-values-reference",children:"Helm Values Reference"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Value"}),(0,a.jsx)(n.th,{children:"Required"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"image.repository"})}),(0,a.jsx)(n.td,{children:"Yes"}),(0,a.jsx)(n.td,{children:"Full image path (without tag)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"image.tag"})}),(0,a.jsx)(n.td,{children:"Yes"}),(0,a.jsx)(n.td,{children:"Image tag"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"obaas.releaseName"})}),(0,a.jsx)(n.td,{children:"Yes"}),(0,a.jsx)(n.td,{children:"OBaaS platform Helm release name"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"obaas.framework"})}),(0,a.jsx)(n.td,{children:"Yes"}),(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"SPRING_BOOT"})," or ",(0,a.jsx)(n.code,{children:"HELIDON"})]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"database.name"})}),(0,a.jsx)(n.td,{children:"If using DB"}),(0,a.jsx)(n.td,{children:"Database name (derives secret names and wallet)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"database.authN.secretName"})}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsxs)(n.td,{children:["Override derived secret name ",(0,a.jsx)(n.code,{children:"{dbname}-{release}-db-authn"})]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"database.aq.enabled"})}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsxs)(n.td,{children:["Grant Advanced Queuing (AQ/JMS) permissions (default: ",(0,a.jsx)(n.code,{children:"false"}),")"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"eureka.enabled"})}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsxs)(n.td,{children:["Register with Eureka service discovery (default: ",(0,a.jsx)(n.code,{children:"true"}),")"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"otel.enabled"})}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsxs)(n.td,{children:["Enable OpenTelemetry integration (default: ",(0,a.jsx)(n.code,{children:"true"}),")"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"otmm.enabled"})}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsxs)(n.td,{children:["Enable MicroTx LRA distributed transactions (default: ",(0,a.jsx)(n.code,{children:"false"}),")"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"service.port"})}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsxs)(n.td,{children:["Container and service port (default: ",(0,a.jsx)(n.code,{children:"8080"}),")"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"replicaCount"})}),(0,a.jsx)(n.td,{children:"No"}),(0,a.jsxs)(n.td,{children:["Number of pod replicas (default: ",(0,a.jsx)(n.code,{children:"1"}),")"]})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"deploy-a-service",children:"Deploy a Service"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"helm upgrade --install my-service obaas/obaas-sample-app \\\n  -f values.yaml \\\n  --namespace <namespace> \\\n  --set image.repository=<registry>/my-service \\\n  --set image.tag=0.0.1-SNAPSHOT \\\n  --set obaas.releaseName=<obaas-release> \\\n  --set database.name=<dbname> \\\n  --wait --timeout 5m\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Values passed via ",(0,a.jsx)(n.code,{children:"--set"})," override those in ",(0,a.jsx)(n.code,{children:"values.yaml"}),". This is useful for CI/CD pipelines where the registry and tag vary per build."]}),"\n",(0,a.jsx)(n.h3,{id:"what-gets-deployed",children:"What Gets Deployed"}),"\n",(0,a.jsxs)(n.p,{children:["For each ",(0,a.jsx)(n.code,{children:"helm install"}),", the chart creates:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Deployment"})," \u2014 your application pod with framework-aware environment variables (datasource, Eureka, OTEL, LRA)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Service"})," \u2014 a ClusterIP service on port 8080 (default)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"DB Init Job"})," \u2014 a Kubernetes Job that runs SQLcl to create the database user if it doesn't already exist. It uses the privileged secret to connect and creates a user matching the application secret credentials. The job retries up to 60 times (10-second intervals) and auto-cleans after 5 minutes."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"DB Init ConfigMap"})," \u2014 the SQL script used by the init job. If ",(0,a.jsx)(n.code,{children:"database.aq.enabled"})," is ",(0,a.jsx)(n.code,{children:"true"}),", AQ permissions (",(0,a.jsx)(n.code,{children:"DBMS_AQ"}),", ",(0,a.jsx)(n.code,{children:"DBMS_AQADM"}),", etc.) are included."]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["The database wallet (TLS certificates for Oracle Autonomous Database) is automatically mounted at ",(0,a.jsx)(n.code,{children:"/oracle/tnsadmin"})," from the OBaaS platform's wallet secret."]}),"\n",(0,a.jsx)(n.h3,{id:"verify-the-deployment",children:"Verify the Deployment"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Check pod status\nkubectl get pods -n <namespace>\n\n# Check service\nkubectl get svc -n <namespace>\n\n# View pod logs\nkubectl logs -n <namespace> -l app.kubernetes.io/name=my-service\n\n# Check the db-init job\nkubectl get jobs -n <namespace>\n\n# Test connectivity via port-forward\nkubectl port-forward -n <namespace> svc/my-service 8080:8080\ncurl http://localhost:8080/actuator/health\n"})}),"\n",(0,a.jsx)(n.h3,{id:"upgrade-and-uninstall",children:"Upgrade and Uninstall"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Upgrade (after pushing a new image)\nhelm upgrade my-service obaas/obaas-sample-app \\\n  -f values.yaml \\\n  --namespace <namespace> \\\n  --set image.tag=0.0.2-SNAPSHOT \\\n  --wait --timeout 5m\n\n# Uninstall\nhelm uninstall my-service -n <namespace>\n"})}),"\n",(0,a.jsx)(n.h2,{id:"step-5-create-api-gateway-routes",children:"Step 5: Create API Gateway Routes"}),"\n",(0,a.jsxs)(n.p,{children:["The OBaaS platform uses ",(0,a.jsx)(n.a,{href:"https://apisix.apache.org/",children:"Apache APISIX"})," as its API gateway. To expose your services externally, create routes that map URI patterns to Eureka service names."]}),"\n",(0,a.jsx)(n.h3,{id:"get-the-apisix-admin-key",children:"Get the APISIX Admin Key"}),"\n",(0,a.jsx)(n.p,{children:"The admin API key is stored in the APISIX ConfigMap:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Replace <obaas-release> with your release name\nkubectl get configmap <obaas-release>-apisix -n <namespace> \\\n  -o jsonpath='{.data.config\\.yaml}' | grep -A2 '\"admin\"'\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Look for the ",(0,a.jsx)(n.code,{children:"key:"})," value under the admin user."]}),"\n",(0,a.jsx)(n.h3,{id:"port-forward-to-the-admin-api",children:"Port-Forward to the Admin API"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward -n <namespace> svc/<obaas-release>-apisix-admin 9180:9180 &\n"})}),"\n",(0,a.jsx)(n.h3,{id:"create-a-route",children:"Create a Route"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'ADMIN_KEY="<your-admin-key>"\n\ncurl http://localhost:9180/apisix/admin/routes/1 \\\n  -H "X-API-KEY: $ADMIN_KEY" \\\n  -H "Content-Type: application/json" \\\n  -X PUT \\\n  -d \'{\n    "name": "my-service",\n    "desc": "My Service",\n    "uri": "/api/v1/my-service*",\n    "methods": ["GET", "POST", "PUT", "DELETE", "OPTIONS", "HEAD"],\n    "upstream": {\n      "service_name": "MY-SERVICE",\n      "type": "roundrobin",\n      "discovery_type": "eureka"\n    },\n    "plugins": {\n      "opentelemetry": {\n        "sampler": {\n          "name": "always_on"\n        }\n      },\n      "prometheus": {\n        "prefer_name": true\n      }\n    }\n  }\'\n'})}),"\n",(0,a.jsx)(n.p,{children:"Key fields:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Field"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"uri"})}),(0,a.jsxs)(n.td,{children:["The URL pattern to match. Use a wildcard suffix (e.g., ",(0,a.jsx)(n.code,{children:"/api/v1/my-service*"}),")."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"upstream.service_name"})}),(0,a.jsx)(n.td,{children:"The Eureka-registered service name (uppercase by default for Spring Boot)."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"upstream.discovery_type"})}),(0,a.jsxs)(n.td,{children:["Set to ",(0,a.jsx)(n.code,{children:"eureka"})," so APISIX resolves service instances from the Eureka registry."]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"plugins.opentelemetry"})}),(0,a.jsx)(n.td,{children:"Enables distributed tracing through the gateway."})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"plugins.prometheus"})}),(0,a.jsx)(n.td,{children:"Enables Prometheus metrics collection for the route."})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"verify-the-route",children:"Verify the Route"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Test through the gateway\ncurl http://<apisix-gateway>/api/v1/my-service/health\n\n# List all routes\ncurl http://localhost:9180/apisix/admin/routes \\\n  -H \"X-API-KEY: $ADMIN_KEY\" | jq '.list[].value.name'\n"})}),"\n",(0,a.jsx)(n.h3,{id:"stop-port-forward",children:"Stop Port-Forward"}),"\n",(0,a.jsx)(n.p,{children:"When done configuring routes, stop the port-forward:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kill %1\n"})}),"\n",(0,a.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,a.jsx)(n.p,{children:"The full deployment flow:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Step"}),(0,a.jsx)(n.th,{children:"What"}),(0,a.jsx)(n.th,{children:"How"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"1"}),(0,a.jsx)(n.td,{children:"Create container repositories"}),(0,a.jsx)(n.td,{children:"OCI CLI or registry UI"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"2"}),(0,a.jsx)(n.td,{children:"Build and push images"}),(0,a.jsxs)(n.td,{children:["Maven + JKube (",(0,a.jsx)(n.code,{children:"k8s:build"})," + ",(0,a.jsx)(n.code,{children:"k8s:push"}),")"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"3"}),(0,a.jsx)(n.td,{children:"Create database secrets"}),(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"kubectl create secret"})})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"4"}),(0,a.jsx)(n.td,{children:"Deploy with Helm"}),(0,a.jsxs)(n.td,{children:[(0,a.jsx)(n.code,{children:"helm upgrade --install"})," with ",(0,a.jsx)(n.code,{children:"obaas-sample-app"})," chart"]})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"5"}),(0,a.jsx)(n.td,{children:"Create API gateway routes"}),(0,a.jsxs)(n.td,{children:["APISIX Admin API via ",(0,a.jsx)(n.code,{children:"curl"})]})]})]})]}),"\n",(0,a.jsx)(n.p,{children:"After all steps are complete, your application is accessible through the APISIX gateway at the URI patterns you configured."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},8453(e,n,s){s.d(n,{R:()=>t,x:()=>l});var r=s(6540);const a={},i=r.createContext(a);function t(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);