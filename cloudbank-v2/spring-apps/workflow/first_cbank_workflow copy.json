{
    "name": "first_cbank_workflow",
    "description": "First Cloud Bank Sample Workflow",
    "version": 1,
    "inputParameters": [
        "fromCustomerEmail",
        "toCustomerEmail",
        "amount"
    ],
    "tasks": [
        {
            "name": "call_customer_service",
            "taskReferenceName": "call_customer_service_from",
            "type": "HTTP",
            "inputParameters": {
                "http_request": {
                    "uri": "http://customer.application.svc.cluster.local:8080/api/v1/customer/byemail/${workflow.input.fromCustomerEmail}",
                    "method": "GET",
                    "connectionTimeOut": 3000,
                    "readTimeOut": 3000
                }
            }
        },
        {
            "name": "call_customer_service",
            "taskReferenceName": "call_customer_service_to",
            "type": "HTTP",
            "inputParameters": {
                "http_request": {
                    "uri": "http://customer.application.svc.cluster.local:8080/api/v1/customer/byemail/${workflow.input.toCustomerEmail}",
                    "method": "GET",
                    "connectionTimeOut": 3000,
                    "readTimeOut": 3000
                }
            }
        },
        {
            "name": "call_account_service",
            "taskReferenceName": "call_account_service_from",
            "type": "HTTP",
            "inputParameters": {
                "fromCustomerId": "${call_customer_service_from.output.response.body.customerId}",
                "http_request": {
                    "uri": "http://account.application.svc.cluster.local:8080/api/v1/account/getAccounts/${call_customer_service_from.output.response.body.customerId}",
                    "method": "GET",
                    "connectionTimeOut": 3000,
                    "readTimeOut": 3000
                }
            }
        },
        {
            "name": "call_account_service",
            "taskReferenceName": "call_account_service_to",
            "type": "HTTP",
            "inputParameters": {
                "toCustomerId": "${call_customer_service_to.output.response.body.customerId}",
                "http_request": {
                    "uri": "http://account.application.svc.cluster.local:8080/api/v1/account/getAccounts/${call_customer_service_to.output.response.body.customerId}",
                    "method": "GET",
                    "connectionTimeOut": 3000,
                    "readTimeOut": 3000
                }
            }
        },
        {
            "name": "jq_cleanup",
            "taskReferenceName": "jq_cleanup_ref",
            "type": "JSON_JQ_TRANSFORM",
            "inputParameters": {
                "fromAccountList": "${call_account_service_from.output.response.body}",
                "queryExpression": "[.starfromAccountList[]]"
            }          
        },
        {
            "name": "call_transfer_service",
            "taskReferenceName": "call_transfer_service",
            "type": "HTTP",
            "inputParameters": {
                "fromAccount": "1",
                "toAccount": "2",
                "http_request": {
                    "uri": "http://transfer.application.svc.cluster.local:8080/api/v1/transfer?fromAccount=22&toAccount=21&amount=${workflow.input.amount}",
                    "method": "POST"
                }
            }
        }
    ],
    "outputParameters": {
        "transferMessage": "${call_transfer_service.output.response.body}"
    },
    "schemaVersion": 2,
    "restartable": true,
    "workflowStatusListenerEnabled": false,
    "ownerEmail": "example@email.com",
    "timeoutPolicy": "ALERT_ONLY",
    "timeoutSeconds": 0
}